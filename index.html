<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>시대별 퀴즈</title>
<style>
body{font-family:system-ui;margin:0;background:#f4f6fb}
.wrap{max-width:800px;margin:0 auto;padding:20px}
.header{background:#fff;padding:16px;border-radius:14px;margin-bottom:12px}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
.tab{padding:8px 14px;border-radius:20px;border:1px solid #ccc;background:#fff;cursor:pointer}
.tab.active{background:#333;color:#fff;border-color:#333}
.card{background:#fff;border-radius:14px;padding:16px;margin-top:12px;box-shadow:0 4px 12px rgba(0,0,0,.05)}
.q{font-weight:700;margin-bottom:10px}
.btn{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;background:#fafafa;cursor:pointer}
.mask{margin-top:8px;color:#888}
ul{margin-top:8px}
</style>
</head>

<body>
<div class="wrap">
<div class="header">
<h2>시대별 퀴즈</h2>
<div id="status">로딩중...</div>
</div>

<div class="tabs" id="tabs"></div>
<div id="list"></div>
</div>

<script>
const API_KEY = "AIzaSyBoepxG2-8I6RNfsYc1kchhyVQvei9NnNA";
const SPREADSHEET_ID = "1CMyntzm9c5-bvtOySDdH2JdNpwxrbTdTIH2cG3ykReE";
const RANGE = "'시트1'!A:C";

let allData = {};
let currentTab = null;

function setStatus(msg){
document.getElementById("status").textContent = msg;
}

function groupByEra(values){
let result = {};

for(let row of values){
if(!row || row.length === 0) continue;

let era = (row[0]||"").trim();
let question = (row[1]||"").trim();
let answer = (row[2]||"").trim();

if(!era || !question) continue;

if(!result[era]) result[era] = [];

result[era].push({
question: question,
answers: answer ? answer.split(",").map(v=>v.trim()) : [],
open:false
});
}

return result;
}

function renderTabs(){
const tabsDiv = document.getElementById("tabs");
tabsDiv.innerHTML = "";

Object.keys(allData).forEach(era=>{
const btn = document.createElement("div");
btn.className = "tab" + (era===currentTab?" active":"");
btn.textContent = era;
btn.onclick = ()=>{
currentTab = era;
renderTabs();
renderList();
};
tabsDiv.appendChild(btn);
});
}

function renderList(){
const list = document.getElementById("list");
list.innerHTML = "";

if(!currentTab) return;

allData[currentTab].forEach((item,i)=>{
const card = document.createElement("div");
card.className="card";

const q = document.createElement("div");
q.className="q";
q.textContent = (i+1)+". "+item.question;
card.appendChild(q);

const btn = document.createElement("button");
btn.className="btn";

const answerCount = item.answers.length;
const maskDots = "●".repeat(answerCount);

btn.textContent = item.open ? "정답 숨기기" : `${maskDots} (${answerCount}개)`;
btn.onclick = ()=>{
item.open=!item.open;
renderList();
};
card.appendChild(btn);

if(item.open){
const ul = document.createElement("ul");
item.answers.forEach(a=>{
const li=document.createElement("li");
li.textContent=a;
ul.appendChild(li);
});
card.appendChild(ul);
}

list.appendChild(card);
});
}

async function loadData(){
const url=`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(RANGE)}?key=${API_KEY}`;
const res = await fetch(url);
const data = await res.json();

allData = groupByEra(data.values||[]);

currentTab = Object.keys(allData)[0];

renderTabs();
renderList();

setStatus("불러오기 완료");
}

window.addEventListener("DOMContentLoaded",loadData);
</script>

</body>
</html>
