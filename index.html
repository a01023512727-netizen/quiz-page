<script>
const API_KEY = "AIzaSyBoepxG2-8I6RNfsYc1kchhyVQvei9NnNA";
const SPREADSHEET_ID = "1CMyntzm9c5-bvtOySDdH2JdNpwxrbTdTIH2cG3ykReE";
const RANGE = "시트1!A:B";

function groupDataFromValues(values){
  // values: [ ["성왕","관산성전투"], ["","진흥왕에게 죽음"], ... ]
  let result = [], current = null;

  for (const row of values) {
    // ✅ 빈 행([]) 무시
    if (!row || row.length === 0) continue;

    const A = (row[0] ?? "").trim();
    const B = (row[1] ?? "").trim();

    if (A) {
      current = { question: A, answers: [], open: false };
      result.push(current);
      if (B) current.answers.push(B);
    } else {
      if (current && B) current.answers.push(B);
    }
  }
  return result;
}

async function loadData(){
  const url =
    `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(RANGE)}?key=${API_KEY}`;

  const res = await fetch(url, { cache: "no-store" });
  if (!res.ok) {
    const t = await res.text();
    alert("시트 불러오기 실패:\n" + t);
    return;
  }

  const data = await res.json();
  const values = data.values || [];
  const quizData = groupDataFromValues(values);
  render(quizData);
}

function render(data){
  const container=document.getElementById("quiz");
  container.innerHTML="";
  data.forEach((item,i)=>{
    const card=document.createElement("div");
    card.className="card";

    const q=document.createElement("div");
    q.className="q";
    q.textContent=(i+1)+". "+item.question;

    const btn=document.createElement("button");
    btn.className="btn";
    btn.textContent=item.open?"정답 숨기기":"정답 보기";
    btn.onclick=()=>{item.open=!item.open;render(data)};

    card.appendChild(q);
    card.appendChild(btn);

    if(!item.open){
      const mask=document.createElement("div");
      mask.className="mask";
      mask.textContent="••••••••••";
      card.appendChild(mask);
    }else{
      const ul=document.createElement("ul");
      item.answers.forEach(a=>{
        const li=document.createElement("li");
        li.textContent=a;
        ul.appendChild(li);
      });
      card.appendChild(ul);
    }
    container.appendChild(card);
  });
}

// ✅ 페이지 열자마자 자동으로 불러오기 (원치 않으면 이 줄 삭제)
loadData();
</script>
